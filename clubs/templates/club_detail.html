{% extends 'club_base_content.html' %}
{% load i18n %}
{% load get_club_user_id %}
{% load club_user_role_num %}
{% load book_rated %}
{% block content%}
{% load static %}
{% get_club_user_id club user as club_user_id %}
{% club_user_role_num club user as role_num %}

<script>
  function showLoaderOnClick(url) {
      showLoader();
      window.location=url;
  }
  function showLoader(){
    $('body').append(
      `<div style="" id="loading">
        <div id="loading-inner" class="text-center">
          <svg class="mx-auto h-24 w-24 animate-spin text-indigo-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <h1 class="mt-8 text-4xl font-extrabold tracking-tight text-gray-900 dark:text-gray-200 sm:text-5xl md:text-6xl">We are just getting your recommendations</h1>
          <p id="loading-subheader" class="lg:mx-50 font-nunito mt-3 text-base text-gray-500 dark:text-gray-300 sm:mx-auto sm:mt-5 sm:max-w-xl sm:text-lg md:mt-5 md:text-xl">Our recommenders can take a couple of minutes to figure you out.</p>
        </div>
      </div>`
    );
  }
</script>

<style>
  #loading {
  position: fixed;
  display: flex;
  justify-content: center;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  text-align: center;
  background-color: #f5f3ff;
  z-index: 99;
  }

  #loading-inner {
    margin-top: 10%;
  }

  #loading-subheader {
    font-size: 25px;
    line-height: 37px;
    margin-top: 40px;
    max-width: 55rem;
  }

  #loading-image {
    margin: auto;
    top: 100px;
    z-index: 100;
  }
</style>

<div class="flex items-center justify-center flex-grow">
  
  
  <card class="flex flex-col p-5 m-5 flex-grow max-w-5xl mx-auto">
      
    <!-- Title -->
    <p class="text-center text-gray-800 text-4xl mt-8">{{club.name}}</p>

    <!-- Description -->
    <div class="text-gray-700 font-light mt-5">
      <div class="mx-auto text-center mt-2">
        <span class="inline-flex space-x-2 items-center px-3 py-0.5 rounded-full text-sm font-medium bg-emerald-50 text-emerald-800">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <span>{{ club.location }}</span>
        </span>
      </div>      
      <p class="relative mx-auto w-2/3 sm:w-1/2 pt-4" >
        <span class="absolute -left-4 pr-4 text-indigo-500/40 text-5xl font-overpass italic font-extrabold -z-10">"</span>
        <span class="text-gray-500 font-bitter font-semibold">{{ club.description }}</span>
      </p>
      <div class="w-2/3 sm:w-1/2 mx-auto pt-4">
        <div class="flex space-x-2 items-center mt-4 ">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <p>{{club.calendar}}</p>
        </div>
        <div class="flex space-x-2 items-center mt-2 ">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <p>{{club.get_meeting_type_display}}</p>
        </div>
        <div class="flex space-x-2 items-center mt-2 ">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <a href="{% url 'user_detail' club.owner.id %}" class="text-indigo-600 hover:text-indigo-900">{{club.owner.full_name}}</a>
        </div>
      </div>
    </div>
    
    <div class="pt-4 mb-16">
      <h3 class="text-lg leading-6 font-medium text-gray-900"></h3>
      <dl class="mt-5 grid grid-cols-1">
        <!-- Club actions -->
        
        {%if role_num == None%}
        <div class="w-1/2 mx-auto inline-flex items-baseline px-2.5 py-0.5 rounded-full text-sm font-medium  md:mt-2 lg:mt-0">
          <div class="text-lg bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" style="cursor: pointer;">
            <a href='{% url 'apply' club.id %}' class="">Apply</a>
          </div>
        </div>
        {%endif%}
        
        {%if role_num == '1'%}
        <div class="w-1/2 mx-auto inline-flex items-baseline px-2.5 py-0.5 rounded-full text-sm font-medium  md:mt-2 lg:mt-0">
          <div class="text-lg bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" style="cursor: pointer;">
            <a href='{% url 'delete_club_user' club_user_id %}' class="">Withdraw Application</a>
          </div>
        </div>
        {%endif%}
        
        {%if club.currently_reading is not None and role_num != None and role_num != '1' %}
          <dt class="text-base font-normal text-gray-900 text-center pt-4">{{club.name}}'s currently reading</dt>
          <div class=" border-gray-400/20 border z-10 shadow-lg bg-transparent rounded-xl overflow-hidden max-w-5xl mt-2 mx-auto">
            <!-- Book Image Background -->
            <div class="-z-10 relative pointer-events-none">
              <img style="background-image: url({% static 'missing_image.png' %})" class="scale-[1.5] absolute opacity-40 bg-center bg-origin-border w-full blur-[5px] sm:bg-cover" src="{{club.currently_reading.image_large}}" alt="Book cover of {{club.currently_reading.title}}.">
            </div>
          
            <div class="p-8">
              <!-- Book Content -->
              <div class="flex justify-between p-4 items-start bg-white/50">
                <div>
                  <div class="sm:flex sm:space-x-4">
                    <h1 class="text-xl  font-semibold font-roboto max-w-5xl">{{club.currently_reading.title}}</h1>
                    <p class="underline text-gray-600 underline-offset-2 font-nunito">{{club.currently_reading.publication_year}}</p>
                  </div>
                  <p class="text-lg">{{club.currently_reading.author}}</p>
                </div>  

                {% book_rated club.currently_reading user as book_rating %}
                
                <div class="font-semibold text-gray-700 text-center ml-8">
                  <!-- Converts book_rating string into int -->
                  {% if book_rating|make_list|last|add:"0" >= 5 %}
                    <p class="font-bold font-manrope border-emerald-400/80 text-emerald-700 border-2 rounded-full py-2 px-4">{{book_rating|make_list|last|add:"0"}}</p>
                  {% elif book_rating|make_list|last|add:"0" <= 5 %}
                    <p class="font-bold font-manrope border-rose-400/80 text-rose-700 border-2 rounded-full py-2 px-4">{{book_rating|make_list|last|add:"0"}}</p>
                  {% else %}
                    <div class="font-semibold text-gray-700 text-center">
                      <p class="font-extrabold font-manrope border-gray-400 text-gray-800 border-2 rounded-full bg-transparent py-2 px-4">-</p>
                    </div>
                  {% endif %}
                </div>
              </div>
          
              <!-- Form Rating -->
              <form class="" action="{% url 'rate_book' club.currently_reading.id%}" method="post">
                {% csrf_token %}
                {% include 'partials/bootstrap_form.html' with form=form %}
                <div class="pt-2 flex justify-between">
                  <button type="submit" class="font-semibold border-blue-400/40 border bg-blue-700/80 hover:bg-blue-800/90 text-blue-50 py-2 px-4 rounded">
                    Rate Book
                  </button>
                  <a href="{% url 'book_detail' club.currently_reading.id %}" class="font-semibold border-blue-400/40 border bg-blue-300/80 hover:bg-blue-400/90 text-blue-800 py-2 px-4 rounded">
                    View Book
                  </a>
                </div>
              </form>
            </div>
          </div>
        {% endif %}


        {%if role_num == '2'%}
        <div class="mt-6 border-t-2 pt-6">
          <div class="inline-flex items-baseline px-2.5 py-0.5 rounded-full text-sm font-medium  md:mt-2 lg:mt-0">
            <div class="bg-rose-100 hover:bg-rose-200 text-rose-600 border border-rose-600 font-bold py-2 px-4 rounded" style="cursor: pointer;">
              <a href='{% url 'delete_club_user' club_user_id %}' class="">Leave club</a>
            </div>
          </div>
        </div>
        {%endif%}

        {% comment %} Club Owner {% endcomment %}
        {%if role_num == '4'%}
          <div class="border-t-2 mt-8 pt-6">
            <div class=" flex justify-between sm:justify-around mx-auto">
              <div class="inline-flex items-baseline px-2.5 py-0.5 rounded-full text-sm font-medium  md:mt-2 lg:mt-0">
                <div class="text-sm sm:text-lg bg-blue-200 hover:bg-blue-400 text-blue-600 border border-blue-600 font-bold py-2 px-4 rounded" style="cursor: pointer;">
                  <a href='{% url 'club_update' club.id %}' class="">Edit club</a>
                </div>
              </div>

              <div class="inline-flex items-baseline px-2.5 py-0.5 rounded-full text-sm font-medium  md:mt-2 lg:mt-0">
                <div class="text-sm sm:text-lg bg-rose-200 hover:bg-rose-400 text-rose-600 border border-rose-600 font-bold py-2 px-4 rounded" style="cursor: pointer;">
                  <a href='{% url 'club_delete' club.id %}' class="">Delete club</a>
                </div>
              </div>
            </div>
          </div>

        {%endif%}
      </dl>
    </div>
  </card>
</div>

{% endblock %}
